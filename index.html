<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Snake Game - Classic Arcade Experience</title>
    <meta name="description" content="Play the classic Snake game with modern, stunning visuals and smooth gameplay">

    <!-- Favicon -->
    <link rel="icon" type="image/svg+xml"
        href="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'%3E%3Cdefs%3E%3ClinearGradient id='snakeGrad' x1='0%25' y1='0%25' x2='100%25' y2='100%25'%3E%3Cstop offset='0%25' style='stop-color:%23667eea;stop-opacity:1' /%3E%3Cstop offset='100%25' style='stop-color:%23f5576c;stop-opacity:1' /%3E%3C/linearGradient%3E%3C/defs%3E%3Crect width='100' height='100' fill='%23141428' rx='20'/%3E%3Cpath d='M30 50 L40 50 L40 40 L50 40 L50 30 L60 30 L60 40 L70 40 L70 50 L60 50 L60 60 L50 60 L50 70 L40 70 L40 60 L30 60 Z' fill='url(%23snakeGrad)' stroke='%23fff' stroke-width='1.5'/%3E%3Ccircle cx='55' cy='35' r='2' fill='%23fff'/%3E%3C/svg%3E">

    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link
        href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700;900&family=Inter:wght@300;400;600&display=swap"
        rel="stylesheet">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', sans-serif;
            background: linear-gradient(135deg, #0f0c29, #302b63, #24243e);
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            overflow: hidden;
            position: relative;
        }

        /* Animated background particles */
        .background-animation {
            position: absolute;
            width: 100%;
            height: 100%;
            overflow: hidden;
            z-index: 0;
        }

        .particle {
            position: absolute;
            width: 4px;
            height: 4px;
            background: rgba(139, 233, 253, 0.3);
            border-radius: 50%;
            animation: float 15s infinite ease-in-out;
        }

        @keyframes float {

            0%,
            100% {
                transform: translateY(0) translateX(0);
                opacity: 0;
            }

            10% {
                opacity: 1;
            }

            90% {
                opacity: 1;
            }

            100% {
                transform: translateY(-100vh) translateX(50px);
                opacity: 0;
            }
        }

        .game-container {
            position: relative;
            z-index: 1;
            background: rgba(255, 255, 255, 0.05);
            backdrop-filter: blur(10px);
            border-radius: 24px;
            padding: 40px;
            box-shadow: 0 8px 32px 0 rgba(31, 38, 135, 0.37);
            border: 1px solid rgba(255, 255, 255, 0.18);
            animation: fadeIn 0.6s ease-out;
            text-align: center;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(-20px);
            }

            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        h1 {
            font-family: 'Orbitron', sans-serif;
            font-weight: 900;
            font-size: 3em;
            text-align: center;
            margin-bottom: 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            text-shadow: 0 0 30px rgba(102, 126, 234, 0.5);
            letter-spacing: 2px;
        }

        /* Logo Container */
        .logo-container {
            text-align: center;
            margin-bottom: 20px;
            animation: fadeIn 0.8s ease-out;
        }

        .logo-container svg {
            max-width: 400px;
            width: 100%;
            height: auto;
            filter: drop-shadow(0 0 20px rgba(102, 126, 234, 0.4));
            transition: transform 0.3s ease;
        }

        .logo-container svg:hover {
            transform: scale(1.05);
            filter: drop-shadow(0 0 30px rgba(102, 126, 234, 0.6));
        }

        .score-board {
            display: flex;
            justify-content: space-around;
            margin-bottom: 20px;
            gap: 20px;
        }

        .score-item {
            background: rgba(255, 255, 255, 0.1);
            padding: 15px 30px;
            border-radius: 12px;
            text-align: center;
            backdrop-filter: blur(5px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }

        .score-item:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 20px rgba(102, 126, 234, 0.4);
        }

        .score-label {
            font-size: 0.9em;
            color: #b8b8d1;
            font-weight: 300;
            margin-bottom: 5px;
        }

        .score-value {
            font-family: 'Orbitron', sans-serif;
            font-size: 2em;
            font-weight: 700;
            background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .canvas-wrapper {
            position: relative;
            display: inline-block;
            border-radius: 16px;
            overflow: hidden;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.5);
            margin: 0 auto;
        }

        #gameCanvas {
            display: block;
            background: rgba(20, 20, 40, 0.8);
            border: 2px solid rgba(102, 126, 234, 0.3);
        }

        .controls {
            margin-top: 20px;
            text-align: center;
        }

        .btn {
            font-family: 'Orbitron', sans-serif;
            padding: 12px 32px;
            margin: 0 10px;
            font-size: 1em;
            font-weight: 600;
            border: none;
            border-radius: 50px;
            cursor: pointer;
            transition: all 0.3s ease;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            box-shadow: 0 4px 15px rgba(102, 126, 234, 0.4);
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 25px rgba(102, 126, 234, 0.6);
        }

        .btn:active {
            transform: translateY(0);
        }

        .btn-secondary {
            background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
            box-shadow: 0 4px 15px rgba(245, 87, 108, 0.4);
        }

        .btn-secondary:hover {
            box-shadow: 0 6px 25px rgba(245, 87, 108, 0.6);
        }

        .instructions {
            margin-top: 20px;
            text-align: center;
            color: #b8b8d1;
            font-size: 0.95em;
            line-height: 1.6;
        }

        .instructions kbd {
            background: rgba(255, 255, 255, 0.1);
            padding: 4px 8px;
            border-radius: 4px;
            font-family: 'Orbitron', monospace;
            font-size: 0.9em;
            border: 1px solid rgba(255, 255, 255, 0.2);
            margin: 0 2px;
        }

        .game-over-overlay {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.85);
            backdrop-filter: blur(5px);
            border-radius: 16px;
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 10;
            animation: fadeIn 0.3s ease-out;
        }

        .game-over-content {
            text-align: center;
            color: white;
            animation: scaleIn 0.4s ease-out;
        }

        @keyframes scaleIn {
            from {
                transform: scale(0.8);
                opacity: 0;
            }

            to {
                transform: scale(1);
                opacity: 1;
            }
        }

        .game-over-title {
            font-family: 'Orbitron', sans-serif;
            font-size: 3em;
            font-weight: 900;
            margin-bottom: 20px;
            background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .final-score {
            font-size: 1.5em;
            margin-bottom: 30px;
            color: #b8b8d1;
        }

        /* Level-up overlay */
        .level-up-overlay {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            z-index: 1000;
            pointer-events: none;
            opacity: 0;
            transition: opacity 0.3s ease;
        }

        .level-up-overlay.show {
            opacity: 1;
            animation: levelUpPulse 1s ease-out;
        }

        @keyframes levelUpPulse {
            0% {
                transform: translate(-50%, -50%) scale(0.5);
                opacity: 0;
            }

            50% {
                transform: translate(-50%, -50%) scale(1.2);
                opacity: 1;
            }

            100% {
                transform: translate(-50%, -50%) scale(1);
                opacity: 0;
            }
        }

        .level-up-text {
            font-family: 'Orbitron', sans-serif;
            font-size: 4em;
            font-weight: 900;
            background: linear-gradient(135deg, #4ade80 0%, #22c55e 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            text-align: center;
            text-shadow: 0 0 50px rgba(74, 222, 128, 0.8);
            filter: drop-shadow(0 0 30px rgba(74, 222, 128, 0.6));
        }

        /* Mobile touch controls */
        .mobile-controls {
            display: none;
            position: relative;
            width: 200px;
            height: 200px;
            margin: 20px auto;
        }

        .d-pad {
            position: relative;
            width: 100%;
            height: 100%;
        }

        .d-pad-btn {
            position: absolute;
            width: 60px;
            height: 60px;
            background: linear-gradient(135deg, rgba(102, 126, 234, 0.8) 0%, rgba(118, 75, 162, 0.8) 100%);
            border: 2px solid rgba(255, 255, 255, 0.3);
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 2em;
            color: white;
            cursor: pointer;
            user-select: none;
            -webkit-user-select: none;
            touch-action: manipulation;
            transition: all 0.2s ease;
            box-shadow: 0 4px 15px rgba(102, 126, 234, 0.4);
        }

        .d-pad-btn:active {
            transform: scale(0.95);
            box-shadow: 0 2px 10px rgba(102, 126, 234, 0.6);
            background: linear-gradient(135deg, rgba(118, 75, 162, 0.9) 0%, rgba(102, 126, 234, 0.9) 100%);
        }

        .d-pad-btn.up {
            top: 0;
            left: 50%;
            transform: translateX(-50%);
        }

        .d-pad-btn.down {
            bottom: 0;
            left: 50%;
            transform: translateX(-50%);
        }

        .d-pad-btn.left {
            left: 0;
            top: 50%;
            transform: translateY(-50%);
        }

        .d-pad-btn.right {
            right: 0;
            top: 50%;
            transform: translateY(-50%);
        }

        .d-pad-btn.up:active {
            transform: translateX(-50%) scale(0.95);
        }

        .d-pad-btn.down:active {
            transform: translateX(-50%) scale(0.95);
        }

        .d-pad-btn.left:active {
            transform: translateY(-50%) scale(0.95);
        }

        .d-pad-btn.right:active {
            transform: translateY(-50%) scale(0.95);
        }

        .d-pad-center {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 50px;
            height: 50px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 50%;
            border: 2px solid rgba(255, 255, 255, 0.2);
        }

        @media (max-width: 768px) {
            h1 {
                font-size: 2em;
            }

            .game-container {
                padding: 20px;
            }

            #gameCanvas {
                width: 300px !important;
                height: 300px !important;
            }

            .level-up-text {
                font-size: 2.5em;
            }

            .mobile-controls {
                display: block;
            }

            .instructions {
                font-size: 0.85em;
            }

            .score-board {
                gap: 10px;
            }

            .score-item {
                padding: 10px 15px;
            }

            .score-value {
                font-size: 1.5em;
            }
        }

        /* Music toggle button */
        .music-toggle {
            position: fixed;
            top: 20px;
            right: 20px;
            width: 50px;
            height: 50px;
            border-radius: 50%;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border: none;
            color: white;
            font-size: 1.5em;
            cursor: pointer;
            box-shadow: 0 4px 15px rgba(102, 126, 234, 0.4);
            transition: all 0.3s ease;
            z-index: 1000;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .music-toggle:hover {
            transform: scale(1.1);
            box-shadow: 0 6px 25px rgba(102, 126, 234, 0.6);
        }

        .music-toggle.muted {
            background: linear-gradient(135deg, #6b7280 0%, #4b5563 100%);
            box-shadow: 0 4px 15px rgba(107, 114, 128, 0.4);
        }

        /* Difficulty selector */
        .difficulty-selector {
            margin: 20px 0;
            text-align: center;
        }

        .difficulty-label {
            color: #b8b8d1;
            font-size: 1em;
            margin-bottom: 12px;
            font-weight: 600;
        }

        .difficulty-options {
            display: flex;
            justify-content: center;
            gap: 15px;
            flex-wrap: wrap;
        }

        .difficulty-btn {
            font-family: 'Orbitron', sans-serif;
            padding: 10px 24px;
            font-size: 0.9em;
            font-weight: 600;
            border: 2px solid rgba(102, 126, 234, 0.3);
            border-radius: 12px;
            cursor: pointer;
            transition: all 0.3s ease;
            background: rgba(255, 255, 255, 0.05);
            color: #b8b8d1;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .difficulty-btn:hover {
            transform: translateY(-2px);
            border-color: rgba(102, 126, 234, 0.6);
            background: rgba(102, 126, 234, 0.1);
        }

        .difficulty-btn.active {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border-color: transparent;
            box-shadow: 0 4px 15px rgba(102, 126, 234, 0.4);
        }

        .difficulty-btn.easy.active {
            background: linear-gradient(135deg, #4ade80 0%, #22c55e 100%);
            box-shadow: 0 4px 15px rgba(74, 222, 128, 0.4);
        }

        .difficulty-btn.hard.active {
            background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
            box-shadow: 0 4px 15px rgba(245, 87, 108, 0.4);
        }

        @media (max-width: 480px) {
            .game-container {
                padding: 15px;
            }

            .controls {
                display: flex;
                flex-direction: column;
                gap: 10px;
            }

            .btn {
                width: 100%;
                margin: 0;
            }

            .music-toggle {
                width: 40px;
                height: 40px;
                font-size: 1.2em;
                top: 15px;
                right: 15px;
            }
        }
    </style>
</head>

<body>
    <!-- Music toggle button -->
    <button class="music-toggle" id="musicToggle" onclick="toggleMusic()" title="Toggle Music">
        üéµ
    </button>

    <div class="background-animation" id="particles"></div>

    <div class="game-container">
        <!-- Logo -->
        <div class="logo-container">
            <svg viewBox="0 0 500 120" xmlns="http://www.w3.org/2000/svg">
                <defs>
                    <linearGradient id="logoGradient" x1="0%" y1="0%" x2="100%" y2="100%">
                        <stop offset="0%" style="stop-color:#667eea;stop-opacity:1" />
                        <stop offset="100%" style="stop-color:#f5576c;stop-opacity:1" />
                    </linearGradient>
                    <filter id="glow">
                        <feGaussianBlur stdDeviation="3" result="coloredBlur" />
                        <feMerge>
                            <feMergeNode in="coloredBlur" />
                            <feMergeNode in="SourceGraphic" />
                        </feMerge>
                    </filter>
                </defs>

                <!-- Snake Icon -->
                <g filter="url(#glow)">
                    <!-- Snake body -->
                    <rect x="15" y="50" width="20" height="20" rx="3" fill="url(#logoGradient)" />
                    <rect x="35" y="50" width="20" height="20" rx="3" fill="url(#logoGradient)" />
                    <rect x="55" y="50" width="20" height="20" rx="3" fill="url(#logoGradient)" />
                    <rect x="55" y="30" width="20" height="20" rx="3" fill="url(#logoGradient)" />
                    <rect x="75" y="30" width="20" height="20" rx="3" fill="url(#logoGradient)" />
                    <rect x="75" y="50" width="20" height="20" rx="3" fill="url(#logoGradient)" />
                    <rect x="75" y="70" width="20" height="20" rx="3" fill="url(#logoGradient)" />
                    <!-- Snake eye -->
                    <circle cx="83" cy="37" r="3" fill="#ffffff" />
                </g>

                <!-- Text: SNAKE -->
                <text x="120" y="75" font-family="Orbitron, sans-serif" font-size="60" font-weight="900"
                    fill="url(#logoGradient)" filter="url(#glow)" letter-spacing="3">
                    SNAKE
                </text>
            </svg>
        </div>

        <div class="score-board">
            <div class="score-item">
                <div class="score-label">Score</div>
                <div class="score-value" id="score">0</div>
            </div>
            <div class="score-item">
                <div class="score-label">Level</div>
                <div class="score-value" id="level">1</div>
            </div>
            <div class="score-item">
                <div class="score-label">High Score</div>
                <div class="score-value" id="highScore">0</div>
            </div>
        </div>

        <div class="canvas-wrapper">
            <canvas id="gameCanvas" width="500" height="500"></canvas>
            <div class="game-over-overlay" id="gameOverOverlay">
                <div class="game-over-content">
                    <div class="game-over-title">GAME OVER</div>
                    <div class="final-score">Final Score: <span id="finalScore">0</span></div>
                    <div class="final-score">Level Reached: <span id="finalLevel">1</span></div>
                    <button class="btn" onclick="restartGame()">Play Again</button>
                </div>
            </div>
        </div>

        <!-- Mobile D-Pad Controls -->
        <div class="mobile-controls">
            <div class="d-pad">
                <div class="d-pad-btn up" id="btnUp">‚Üë</div>
                <div class="d-pad-btn down" id="btnDown">‚Üì</div>
                <div class="d-pad-btn left" id="btnLeft">‚Üê</div>
                <div class="d-pad-btn right" id="btnRight">‚Üí</div>
                <div class="d-pad-center"></div>
            </div>
        </div>

        <!-- Difficulty Selector -->
        <div class="difficulty-selector">
            <div class="difficulty-label">Select Difficulty</div>
            <div class="difficulty-options">
                <button class="difficulty-btn easy" onclick="setDifficulty('easy')">üê¢ Easy</button>
                <button class="difficulty-btn medium active" onclick="setDifficulty('medium')">üö∂ Medium</button>
                <button class="difficulty-btn hard" onclick="setDifficulty('hard')">üöÄ Hard</button>
            </div>
        </div>

        <div class="controls">
            <button class="btn" id="startBtn" onclick="startGame()">Start Game</button>
            <button class="btn btn-secondary" onclick="pauseGame()">Pause</button>
        </div>

        <div class="instructions">
            <p><span class="mobile-only">Use on-screen controls or swipe to move!</span>
                <span class="desktop-only">Use arrow keys <kbd>‚Üë</kbd> <kbd>‚Üì</kbd> <kbd>‚Üê</kbd> <kbd>‚Üí</kbd> or
                    <kbd>W</kbd> <kbd>A</kbd> <kbd>S</kbd> <kbd>D</kbd> to move</span>
            </p>
            <p>Eat the food to grow and increase your score! Reach 50 points to level up!</p>
            <p>Each level increases speed and adds obstacles!</p>
        </div>
    </div>

    <!-- Level-up notification -->
    <div class="level-up-overlay" id="levelUpOverlay">
        <div class="level-up-text">LEVEL UP!</div>
    </div>

    <script>
        // Sound effects using Web Audio API
        const audioContext = new (window.AudioContext || window.webkitAudioContext)();

        // Background music variables
        let musicInterval = null;
        let isMusicPlaying = false;
        let isMusicMuted = localStorage.getItem('snakeMusicMuted') === 'true';

        // Update music button state on load
        if (isMusicMuted) {
            document.getElementById('musicToggle').classList.add('muted');
            document.getElementById('musicToggle').textContent = 'üîá';
        }

        function playEatSound() {
            const oscillator = audioContext.createOscillator();
            const gainNode = audioContext.createGain();

            oscillator.connect(gainNode);
            gainNode.connect(audioContext.destination);

            oscillator.frequency.value = 800;
            oscillator.type = 'sine';

            gainNode.gain.setValueAtTime(0.3, audioContext.currentTime);
            gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.1);

            oscillator.start(audioContext.currentTime);
            oscillator.stop(audioContext.currentTime + 0.1);
        }

        function playGameStartSound() {
            const oscillator = audioContext.createOscillator();
            const gainNode = audioContext.createGain();

            oscillator.connect(gainNode);
            gainNode.connect(audioContext.destination);

            oscillator.frequency.setValueAtTime(400, audioContext.currentTime);
            oscillator.frequency.exponentialRampToValueAtTime(800, audioContext.currentTime + 0.2);
            oscillator.type = 'square';

            gainNode.gain.setValueAtTime(0.2, audioContext.currentTime);
            gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.2);

            oscillator.start(audioContext.currentTime);
            oscillator.stop(audioContext.currentTime + 0.2);
        }

        function playGameOverSound() {
            const oscillator = audioContext.createOscillator();
            const gainNode = audioContext.createGain();

            oscillator.connect(gainNode);
            gainNode.connect(audioContext.destination);

            oscillator.frequency.setValueAtTime(600, audioContext.currentTime);
            oscillator.frequency.exponentialRampToValueAtTime(200, audioContext.currentTime + 0.5);
            oscillator.type = 'sawtooth';

            gainNode.gain.setValueAtTime(0.3, audioContext.currentTime);
            gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.5);

            oscillator.start(audioContext.currentTime);
            oscillator.stop(audioContext.currentTime + 0.5);
        }

        // Background music using a simple melody
        function playBackgroundMusic() {
            if (isMusicMuted || !isGameRunning) return;

            // Simple melody pattern (frequencies in Hz)
            const melody = [523.25, 587.33, 659.25, 698.46, 783.99, 698.46, 659.25, 587.33];
            let noteIndex = 0;

            function playNote() {
                if (!isGameRunning || isMusicMuted) return;

                const oscillator = audioContext.createOscillator();
                const gainNode = audioContext.createGain();

                oscillator.connect(gainNode);
                gainNode.connect(audioContext.destination);

                oscillator.frequency.value = melody[noteIndex];
                oscillator.type = 'triangle';

                gainNode.gain.setValueAtTime(0.05, audioContext.currentTime);
                gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.3);

                oscillator.start(audioContext.currentTime);
                oscillator.stop(audioContext.currentTime + 0.3);

                noteIndex = (noteIndex + 1) % melody.length;
            }

            playNote(); // Play first note immediately
            musicInterval = setInterval(playNote, 350); // Continue playing notes
        }

        function stopBackgroundMusic() {
            if (musicInterval) {
                clearInterval(musicInterval);
                musicInterval = null;
            }
        }

        function toggleMusic() {
            isMusicMuted = !isMusicMuted;
            localStorage.setItem('snakeMusicMuted', isMusicMuted);

            const musicBtn = document.getElementById('musicToggle');

            if (isMusicMuted) {
                musicBtn.classList.add('muted');
                musicBtn.textContent = 'üîá';
                stopBackgroundMusic();
            } else {
                musicBtn.classList.remove('muted');
                musicBtn.textContent = 'üéµ';
                if (isGameRunning) {
                    playBackgroundMusic();
                }
            }
        }

        // Create animated background particles
        const particlesContainer = document.getElementById('particles');
        for (let i = 0; i < 30; i++) {
            const particle = document.createElement('div');
            particle.className = 'particle';
            particle.style.left = Math.random() * 100 + '%';
            particle.style.animationDelay = Math.random() * 15 + 's';
            particle.style.animationDuration = (10 + Math.random() * 10) + 's';
            particlesContainer.appendChild(particle);
        }

        // Game variables
        const canvas = document.getElementById('gameCanvas');
        const ctx = canvas.getContext('2d');
        const gridSize = 20;
        const tileCount = canvas.width / gridSize;

        let snake = [{ x: 10, y: 10 }];
        let food = { x: 15, y: 15 };
        let obstacles = [];
        let dx = 0;
        let dy = 0;
        let score = 0;
        let level = 1;
        let gameSpeed = 100;
        let baseGameSpeed = 100; // Base speed for medium difficulty
        let difficulty = localStorage.getItem('snakeDifficulty') || 'medium';
        let highScore = localStorage.getItem('snakeHighScore') || 0;
        let gameLoop;
        let isGameRunning = false;
        let isPaused = false;

        // Difficulty settings
        const difficultySettings = {
            easy: { speed: 150, label: 'Easy' },
            medium: { speed: 100, label: 'Medium' },
            hard: { speed: 60, label: 'Hard' }
        };

        // Set difficulty function
        function setDifficulty(level) {
            difficulty = level;
            baseGameSpeed = difficultySettings[level].speed;
            localStorage.setItem('snakeDifficulty', level);

            // Update button states
            document.querySelectorAll('.difficulty-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            document.querySelector(`.difficulty-btn.${level}`).classList.add('active');

            // If game is running, restart with new difficulty
            if (isGameRunning) {
                restartGame();
            }
        }

        // Apply saved difficulty on load
        setDifficulty(difficulty);

        document.getElementById('highScore').textContent = highScore;

        // Gradient colors for snake
        const snakeGradient = ctx.createLinearGradient(0, 0, canvas.width, canvas.height);
        snakeGradient.addColorStop(0, '#667eea');
        snakeGradient.addColorStop(1, '#764ba2');

        const foodGradient = ctx.createLinearGradient(0, 0, canvas.width, canvas.height);
        foodGradient.addColorStop(0, '#f093fb');
        foodGradient.addColorStop(1, '#f5576c');

        const obstacleGradient = ctx.createLinearGradient(0, 0, canvas.width, canvas.height);
        obstacleGradient.addColorStop(0, '#ff6b6b');
        obstacleGradient.addColorStop(1, '#ee5a6f');

        // Mobile touch controls
        let touchStartX = 0;
        let touchStartY = 0;

        // Touch event handlers for swipe gestures
        canvas.addEventListener('touchstart', (e) => {
            touchStartX = e.touches[0].clientX;
            touchStartY = e.touches[0].clientY;
            e.preventDefault();
        }, { passive: false });

        canvas.addEventListener('touchmove', (e) => {
            e.preventDefault();
        }, { passive: false });

        canvas.addEventListener('touchend', (e) => {
            if (!isGameRunning) {
                startGame();
                return;
            }

            const touchEndX = e.changedTouches[0].clientX;
            const touchEndY = e.changedTouches[0].clientY;
            const diffX = touchEndX - touchStartX;
            const diffY = touchEndY - touchStartY;

            // Determine swipe direction
            if (Math.abs(diffX) > Math.abs(diffY)) {
                // Horizontal swipe
                if (diffX > 30 && dx === 0) {
                    dx = 1;
                    dy = 0;
                } else if (diffX < -30 && dx === 0) {
                    dx = -1;
                    dy = 0;
                }
            } else {
                // Vertical swipe
                if (diffY > 30 && dy === 0) {
                    dx = 0;
                    dy = 1;
                } else if (diffY < -30 && dy === 0) {
                    dx = 0;
                    dy = -1;
                }
            }
            e.preventDefault();
        }, { passive: false });

        // D-Pad button handlers
        document.getElementById('btnUp').addEventListener('touchstart', (e) => {
            if (isGameRunning && dy === 0) {
                dx = 0;
                dy = -1;
            }
            e.preventDefault();
        });

        document.getElementById('btnDown').addEventListener('touchstart', (e) => {
            if (isGameRunning && dy === 0) {
                dx = 0;
                dy = 1;
            }
            e.preventDefault();
        });

        document.getElementById('btnLeft').addEventListener('touchstart', (e) => {
            if (isGameRunning && dx === 0) {
                dx = -1;
                dy = 0;
            }
            e.preventDefault();
        });

        document.getElementById('btnRight').addEventListener('touchstart', (e) => {
            if (isGameRunning && dx === 0) {
                dx = 1;
                dy = 0;
            }
            e.preventDefault();
        });

        // Level system
        function checkLevelUp() {
            // Every 50 points = new level
            const newLevel = Math.floor(score / 50) + 1;
            if (newLevel > level) {
                level = newLevel;
                document.getElementById('level').textContent = level;
                showLevelUpNotification();
                addObstacles();
                updateGameSpeed();

                // Restart game loop with new speed
                clearInterval(gameLoop);
                gameLoop = setInterval(update, gameSpeed);
            }
        }

        function showLevelUpNotification() {
            const overlay = document.getElementById('levelUpOverlay');
            overlay.classList.add('show');
            setTimeout(() => {
                overlay.classList.remove('show');
            }, 1000);
        }

        function updateGameSpeed() {
            // Increase speed by 10% each level, with a minimum based on difficulty
            const minSpeed = difficulty === 'easy' ? 80 : (difficulty === 'hard' ? 30 : 50);
            gameSpeed = Math.max(minSpeed, baseGameSpeed - (level - 1) * 10);
        }

        function addObstacles() {
            // Add 2-3 new obstacles per level after level 1
            if (level > 1) {
                const numObstacles = 2 + Math.floor(Math.random() * 2);
                for (let i = 0; i < numObstacles; i++) {
                    let obstacle;
                    let attempts = 0;
                    do {
                        obstacle = {
                            x: Math.floor(Math.random() * tileCount),
                            y: Math.floor(Math.random() * tileCount)
                        };
                        attempts++;
                    } while (
                        (snake.some(seg => seg.x === obstacle.x && seg.y === obstacle.y) ||
                            obstacles.some(obs => obs.x === obstacle.x && obs.y === obstacle.y) ||
                            (food.x === obstacle.x && food.y === obstacle.y)) &&
                        attempts < 50
                    );
                    if (attempts < 50) {
                        obstacles.push(obstacle);
                    }
                }
            }
        }

        // Draw obstacles
        function drawObstacles() {
            obstacles.forEach(obstacle => {
                ctx.shadowBlur = 15;
                ctx.shadowColor = '#ff6b6b';
                ctx.fillStyle = obstacleGradient;
                ctx.beginPath();
                ctx.roundRect(
                    obstacle.x * gridSize + 1,
                    obstacle.y * gridSize + 1,
                    gridSize - 2,
                    gridSize - 2,
                    3
                );
                ctx.fill();
            });
            ctx.shadowBlur = 0;
        }

        // Draw snake with glow effect
        function drawSnake() {
            snake.forEach((segment, index) => {
                // Glow effect
                ctx.shadowBlur = 15;
                ctx.shadowColor = '#667eea';

                // Draw segment
                ctx.fillStyle = snakeGradient;
                ctx.beginPath();
                ctx.roundRect(
                    segment.x * gridSize + 2,
                    segment.y * gridSize + 2,
                    gridSize - 4,
                    gridSize - 4,
                    4
                );
                ctx.fill();

                // Head highlight
                if (index === 0) {
                    ctx.fillStyle = 'rgba(255, 255, 255, 0.3)';
                    ctx.beginPath();
                    ctx.roundRect(
                        segment.x * gridSize + 4,
                        segment.y * gridSize + 4,
                        gridSize - 8,
                        gridSize - 8,
                        3
                    );
                    ctx.fill();
                }
            });
            ctx.shadowBlur = 0;
        }

        // Draw food with pulsing animation
        let foodPulse = 0;
        function drawFood() {
            foodPulse += 0.1;
            const pulseSize = Math.sin(foodPulse) * 2;

            ctx.shadowBlur = 20;
            ctx.shadowColor = '#f5576c';
            ctx.fillStyle = foodGradient;
            ctx.beginPath();
            ctx.arc(
                food.x * gridSize + gridSize / 2,
                food.y * gridSize + gridSize / 2,
                (gridSize / 2 - 2) + pulseSize,
                0,
                Math.PI * 2
            );
            ctx.fill();
            ctx.shadowBlur = 0;
        }

        // Draw grid
        function drawGrid() {
            ctx.strokeStyle = 'rgba(102, 126, 234, 0.1)';
            ctx.lineWidth = 1;
            for (let i = 0; i <= tileCount; i++) {
                ctx.beginPath();
                ctx.moveTo(i * gridSize, 0);
                ctx.lineTo(i * gridSize, canvas.height);
                ctx.stroke();

                ctx.beginPath();
                ctx.moveTo(0, i * gridSize);
                ctx.lineTo(canvas.width, i * gridSize);
                ctx.stroke();
            }
        }

        // Move snake
        function moveSnake() {
            if (dx === 0 && dy === 0) return;

            const head = { x: snake[0].x + dx, y: snake[0].y + dy };

            // Check wall collision
            if (head.x < 0 || head.x >= tileCount || head.y < 0 || head.y >= tileCount) {
                gameOver();
                return;
            }

            // Check self collision
            if (snake.some(segment => segment.x === head.x && segment.y === head.y)) {
                gameOver();
                return;
            }

            // Check obstacle collision
            if (obstacles.some(obstacle => obstacle.x === head.x && obstacle.y === head.y)) {
                gameOver();
                return;
            }

            snake.unshift(head);

            // Check food collision
            if (head.x === food.x && head.y === food.y) {
                score += 10;
                document.getElementById('score').textContent = score;
                playEatSound(); // Play sound when eating
                generateFood();
                checkLevelUp();

                // Update high score
                if (score > highScore) {
                    highScore = score;
                    localStorage.setItem('snakeHighScore', highScore);
                    document.getElementById('highScore').textContent = highScore;
                }
            } else {
                snake.pop();
            }
        }

        // Generate food
        function generateFood() {
            let attempts = 0;
            do {
                food = {
                    x: Math.floor(Math.random() * tileCount),
                    y: Math.floor(Math.random() * tileCount)
                };
                attempts++;
            } while (
                (snake.some(segment => segment.x === food.x && segment.y === food.y) ||
                    obstacles.some(obstacle => obstacle.x === food.x && obstacle.y === food.y)) &&
                attempts < 100
            );
        }

        // Game loop
        function update() {
            if (!isGameRunning || isPaused) return;

            ctx.fillStyle = 'rgba(20, 20, 40, 0.8)';
            ctx.fillRect(0, 0, canvas.width, canvas.height);

            drawGrid();
            drawObstacles();
            drawFood();
            moveSnake();
            drawSnake();
        }

        // Start game
        function startGame() {
            if (isGameRunning) return;

            snake = [{ x: 10, y: 10 }];
            obstacles = [];
            dx = 1;
            dy = 0;
            score = 0;
            level = 1;
            gameSpeed = baseGameSpeed; // Use difficulty base speed
            isGameRunning = true;
            isPaused = false;
            document.getElementById('score').textContent = score;
            document.getElementById('level').textContent = level;
            document.getElementById('gameOverOverlay').style.display = 'none';
            document.getElementById('startBtn').textContent = 'Restart';

            playGameStartSound(); // Play sound when game starts
            playBackgroundMusic(); // Start background music
            generateFood();
            gameLoop = setInterval(update, gameSpeed);
        }

        // Pause game
        function pauseGame() {
            if (!isGameRunning) return;
            isPaused = !isPaused;

            if (isPaused) {
                stopBackgroundMusic();
            } else {
                playBackgroundMusic();
            }
        }

        // Game over
        function gameOver() {
            isGameRunning = false;
            clearInterval(gameLoop);
            stopBackgroundMusic(); // Stop background music
            playGameOverSound(); // Play sound when game is over
            document.getElementById('finalScore').textContent = score;
            document.getElementById('finalLevel').textContent = level;
            document.getElementById('gameOverOverlay').style.display = 'flex';
        }

        // Restart game
        function restartGame() {
            document.getElementById('gameOverOverlay').style.display = 'none';
            isGameRunning = false;
            clearInterval(gameLoop);
            startGame();
        }

        // Keyboard controls
        document.addEventListener('keydown', (e) => {
            if (!isGameRunning) {
                if (e.key === ' ' || e.key === 'Enter') {
                    startGame();
                }
                return;
            }

            switch (e.key) {
                case 'ArrowUp':
                case 'w':
                case 'W':
                    if (dy === 0) { dx = 0; dy = -1; }
                    break;
                case 'ArrowDown':
                case 's':
                case 'S':
                    if (dy === 0) { dx = 0; dy = 1; }
                    break;
                case 'ArrowLeft':
                case 'a':
                case 'A':
                    if (dx === 0) { dx = -1; dy = 0; }
                    break;
                case 'ArrowRight':
                case 'd':
                case 'D':
                    if (dx === 0) { dx = 1; dy = 0; }
                    break;
                case ' ':
                case 'p':
                case 'P':
                    pauseGame();
                    break;
            }
            e.preventDefault();
        });

        // Initial draw
        ctx.fillStyle = 'rgba(20, 20, 40, 0.8)';
        ctx.fillRect(0, 0, canvas.width, canvas.height);
        drawGrid();
        drawFood();
        drawSnake();

        // Add roundRect polyfill for older browsers
        if (!CanvasRenderingContext2D.prototype.roundRect) {
            CanvasRenderingContext2D.prototype.roundRect = function (x, y, width, height, radius) {
                this.moveTo(x + radius, y);
                this.lineTo(x + width - radius, y);
                this.arcTo(x + width, y, x + width, y + radius, radius);
                this.lineTo(x + width, y + height - radius);
                this.arcTo(x + width, y + height, x + width - radius, y + height, radius);
                this.lineTo(x + radius, y + height);
                this.arcTo(x, y + height, x, y + height - radius, radius);
                this.lineTo(x, y + radius);
                this.arcTo(x, y, x + radius, y, radius);
            };
        }
    </script>
</body>

</html>
